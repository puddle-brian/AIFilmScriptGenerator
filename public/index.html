<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Film Script Generator</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">Film Script Generator</h1>
            <p class="subtitle">Create professional scripts with AI-powered hierarchical development</p>
        </header>

        <!-- Project Header (shown when project is loaded) -->
        <div class="project-header" id="projectHeader" style="display: none;">
            <div class="project-info">
                <div class="project-title-section">
                    <h2 class="project-title" id="projectTitle">Project Title</h2>
                    <span class="project-status" id="projectStatus">Working on Structure</span>
                </div>
                <div class="project-meta">
                    <span class="project-template" id="projectTemplate">Template: Three-Act Structure</span>
                    <span class="project-separator">‚Ä¢</span>
                    <span class="project-scenes" id="projectScenes">70 scenes</span>
                    <span class="project-separator">‚Ä¢</span>
                    <span class="project-id" id="projectId">ID: abc123</span>
                </div>
            </div>
            <div class="project-actions">
                <button class="btn btn-sm btn-outline" onclick="showLoadProjectModal()">üìÅ Load Project</button>
                <button class="btn btn-sm btn-outline" onclick="showProjectDetails()">üìã Details</button>
                <button class="btn btn-sm btn-secondary" onclick="saveProject()">üíæ Save</button>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-steps">
                <div class="step" data-step="1"><span>Story Input</span></div>
                <div class="step" data-step="2"><span>Template</span></div>
                <div class="step" data-step="3"><span>Structure</span></div>
                <div class="step" data-step="4"><span>Plot Points</span></div>
                <div class="step" data-step="5"><span>Scenes</span></div>
                <div class="step" data-step="6"><span>Dialogue</span></div>
                <div class="step" data-step="7"><span>Export</span></div>
            </div>
        </div>

        <!-- Step 1: Story Input -->
        <section class="workflow-step active" id="step1">
            <div class="card">
                <h2>Step 1: Story Concept & Influences</h2>
                <form id="storyForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="title">Title</label>
                            <input type="text" id="title" name="title" required placeholder="Enter your story title">
                        </div>
                        
                        <div class="form-group">
                            <label for="totalScenes">Total Scenes</label>
                            <input type="number" id="totalScenes" name="totalScenes" value="70" min="20" max="150" required>
                        </div>
                    </div>
                    

                    
                    <div class="form-group">
                        <label for="logline">Logline</label>
                        <textarea id="logline" name="logline" required rows="3" 
                                placeholder="A brief, compelling summary of your story in 1-2 sentences"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="characters">Main Characters</label>
                        <textarea id="characters" name="characters" required rows="4" 
                                placeholder="Describe your main characters and their psychological/social contexts"></textarea>
                    </div>

                    <!-- Director Influences -->
                    <div class="form-group">
                        <label for="directorInfluences">Directorial Style Influences</label>
                        <div class="influence-container">
                            <select id="directorSelect" class="influence-select">
                                <option value="">Select a director...</option>
                                <option value="Ingmar Bergman">Ingmar Bergman</option>
                                <option value="Akira Kurosawa">Akira Kurosawa</option>
                                <option value="Federico Fellini">Federico Fellini</option>
                                <option value="Jean-Luc Godard">Jean-Luc Godard</option>
                                <option value="Andrei Tarkovsky">Andrei Tarkovsky</option>
                                <option value="Luis Bu√±uel">Luis Bu√±uel</option>
                                <option value="Michelangelo Antonioni">Michelangelo Antonioni</option>
                                <option value="Fran√ßois Truffaut">Fran√ßois Truffaut</option>
                                <option value="Vittorio De Sica">Vittorio De Sica</option>
                                <option value="Yasujir≈ç Ozu">Yasujir≈ç Ozu</option>
                                <option value="Robert Bresson">Robert Bresson</option>
                                <option value="Krzysztof Kie≈õlowski">Krzysztof Kie≈õlowski</option>
                                <option value="Agn√®s Varda">Agn√®s Varda</option>
                                <option value="Chantal Akerman">Chantal Akerman</option>
                                <option value="Wong Kar-wai">Wong Kar-wai</option>
                                <option value="Abbas Kiarostami">Abbas Kiarostami</option>
                                <option value="B√©la Tarr">B√©la Tarr</option>
                                <option value="Apichatpong Weerasethakul">Apichatpong Weerasethakul</option>
                            </select>
                            <button type="button" class="add-influence-btn" onclick="addInfluence('director')">+</button>
                            <input type="text" id="customDirector" placeholder="Or type custom director..." class="custom-input">
                        </div>
                        <div id="directorTags" class="influence-tags"></div>
                    </div>

                    <!-- Screenwriter Influences -->
                    <div class="form-group">
                        <label for="screenwriterInfluences">Screenwriter Influences</label>
                        <div class="influence-container">
                            <select id="screenwriterSelect" class="influence-select">
                                <option value="">Select a screenwriter...</option>
                                <option value="Cesare Zavattini (Bicycle Thieves, Umberto D)">Cesare Zavattini (Bicycle Thieves, Umberto D)</option>
                                <option value="Suso Cecchi d'Amico (Rocco and His Brothers, 8¬Ω)">Suso Cecchi d'Amico (Rocco and His Brothers, 8¬Ω)</option>
                                <option value="Jean-Claude Carri√®re (Belle de Jour, The Discreet Charm)">Jean-Claude Carri√®re (Belle de Jour, The Discreet Charm)</option>
                                <option value="Tonino Guerra (L'Avventura, Amarcord)">Tonino Guerra (L'Avventura, Amarcord)</option>
                                <option value="Krzysztof Piesiewicz (Dekalog, Three Colors)">Krzysztof Piesiewicz (Dekalog, Three Colors)</option>
                                <option value="Marguerite Duras (Hiroshima Mon Amour, India Song)">Marguerite Duras (Hiroshima Mon Amour, India Song)</option>
                                <option value="Alain Robbe-Grillet (Last Year at Marienbad)">Alain Robbe-Grillet (Last Year at Marienbad)</option>
                                <option value="Paul Schrader (Taxi Driver, Raging Bull)">Paul Schrader (Taxi Driver, Raging Bull)</option>
                                <option value="Charlie Kaufman (Being John Malkovich, Synecdoche)">Charlie Kaufman (Being John Malkovich, Synecdoche)</option>
                                <option value="Ari Aster (Hereditary, Midsommar)">Ari Aster (Hereditary, Midsommar)</option>
                                <option value="C√©line Sciamma (Portrait of a Lady on Fire)">C√©line Sciamma (Portrait of a Lady on Fire)</option>
                                <option value="Chlo√© Zhao (The Rider, Nomadland)">Chlo√© Zhao (The Rider, Nomadland)</option>
                            </select>
                            <button type="button" class="add-influence-btn" onclick="addInfluence('screenwriter')">+</button>
                            <input type="text" id="customScreenwriter" placeholder="Or type custom screenwriter..." class="custom-input">
                        </div>
                        <div id="screenwriterTags" class="influence-tags"></div>
                    </div>

                    <!-- Film Influences -->
                    <div class="form-group">
                        <label for="filmInfluences">Film Influences</label>
                        <div class="influence-container">
                            <select id="filmSelect" class="influence-select">
                                <option value="">Select a film...</option>
                                <option value="8¬Ω (1963)">8¬Ω (1963)</option>
                                <option value="Persona (1966)">Persona (1966)</option>
                                <option value="Bicycle Thieves (1948)">Bicycle Thieves (1948)</option>
                                <option value="Breathless (1960)">Breathless (1960)</option>
                                <option value="Rashomon (1950)">Rashomon (1950)</option>
                                <option value="L'Avventura (1960)">L'Avventura (1960)</option>
                                <option value="The 400 Blows (1959)">The 400 Blows (1959)</option>
                                <option value="Tokyo Story (1953)">Tokyo Story (1953)</option>
                                <option value="Stalker (1979)">Stalker (1979)</option>
                                <option value="Vertigo (1958)">Vertigo (1958)</option>
                                <option value="Mulholland Drive (2001)">Mulholland Drive (2001)</option>
                                <option value="In the Mood for Love (2000)">In the Mood for Love (2000)</option>
                                <option value="Jeanne Dielman (1975)">Jeanne Dielman (1975)</option>
                                <option value="The Mirror (1975)">The Mirror (1975)</option>
                                <option value="Cl√©o from 5 to 7 (1962)">Cl√©o from 5 to 7 (1962)</option>
                                <option value="Taste of Cherry (1997)">Taste of Cherry (1997)</option>
                                <option value="S√°t√°ntang√≥ (1994)">S√°t√°ntang√≥ (1994)</option>
                                <option value="Tropical Malady (2004)">Tropical Malady (2004)</option>
                            </select>
                            <button type="button" class="add-influence-btn" onclick="addInfluence('film')">+</button>
                            <input type="text" id="customFilm" placeholder="Or type custom film..." class="custom-input">
                        </div>
                        <div id="filmTags" class="influence-tags"></div>
                    </div>

                    <!-- Tone/Style -->
                    <div class="form-group">
                        <label for="tone">Tone/Style</label>
                        <select id="tone" name="tone" required>
                            <option value="">Select tone</option>
                            <option value="Contemplative/Meditative">Contemplative/Meditative</option>
                            <option value="Psychological Intensity">Psychological Intensity</option>
                            <option value="Existential Angst">Existential Angst</option>
                            <option value="Poetic Realism">Poetic Realism</option>
                            <option value="Surreal/Dreamlike">Surreal/Dreamlike</option>
                            <option value="Social Commentary">Social Commentary</option>
                            <option value="Intimate/Chamber">Intimate/Chamber</option>
                            <option value="Experimental/Avant-garde">Experimental/Avant-garde</option>
                            <option value="Melancholic Beauty">Melancholic Beauty</option>
                            <option value="Philosophical Inquiry">Philosophical Inquiry</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="autoGenerate()">üé≤ Auto Generate (Debug)</button>
                        <button type="button" class="btn btn-secondary" onclick="showLoadProjectModal()">üìÅ Load Previous Project</button>
                        <button type="submit" class="btn btn-primary">Continue to Structure Selection</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Step 2: Template Selection -->
        <section class="workflow-step" id="step2">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">‚Üê Story Input</button>
                    <span class="breadcrumb-current">Template Selection</span>
                </div>
                <h2>Step 2: Choose Plot Structure</h2>
                <p class="step-description">Select a story structure template that best fits your narrative:</p>
                <div id="templateOptions">
                    <!-- Templates will be loaded here -->
                </div>
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="goToStep(1)">Back</button>
                    <button class="btn btn-outline" id="previewPromptBtn" disabled onclick="previewPrompt()">üîç Preview Prompt</button>
                    <button class="btn btn-primary" id="selectTemplateBtn" disabled onclick="generateStructure()">Generate Structure</button>
                </div>
            </div>
        </section>

        <!-- Step 3: Structure Review -->
        <section class="workflow-step" id="step3">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">Story Input</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(2)">Template</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <span class="breadcrumb-current">Structure Review</span>
                </div>
                <h2>Step 3: Review Plot Structure</h2>
                <p class="step-description">Review and approve the generated plot structure:</p>
                <div id="structureContent">
                    <!-- Generated structure will appear here -->
                </div>
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="goToStep(2)">Back</button>
                    <button class="btn btn-outline" onclick="regenerateStructure()">Regenerate</button>
                    <button class="btn btn-primary" onclick="approveStructure()">Approve & Generate Plot Points</button>
                </div>
            </div>
        </section>

        <!-- Step 4: Plot Points Generation -->
        <section class="workflow-step" id="step4">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">Story Input</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(2)">Template</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(3)">Structure</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <span class="breadcrumb-current">Plot Points</span>
                </div>
                <h2>Step 4: Generate Plot Points</h2>
                <p class="step-description">Generate causal plot points for each structural element. These will guide the scene creation process.</p>
                
                <div id="plotPointsContent">
                    <!-- Plot points will be generated here -->
                </div>
                
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="goToStep(3)">Back</button>
                    <button class="btn btn-primary" onclick="goToStep(5)">Continue to Scenes</button>
                </div>
            </div>
        </section>

        <!-- Step 5: Scenes Review -->
        <section class="workflow-step" id="step5">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">Story Input</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(2)">Template</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(3)">Structure</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(4)">Plot Points</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <span class="breadcrumb-current">Scenes</span>
                </div>
                <h2>Step 5: Generate Scenes</h2>
                <p class="step-description">Generate scenes for each structural element using the plot points as guidance.</p>
                
                <!-- Scene Generation Options -->
                <div class="scene-generation-options" id="sceneGenerationOptions" style="margin-bottom: 20px;">
                    <h3>Scene & Plot Management</h3>
                    
                    <div class="plot-generation-section" style="margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="generateAllPlotPoints()" title="Generate connected plot points for all scenes">
                            üìã Generate All Plot Points
                        </button>
                        <button class="btn btn-outline" onclick="previewAllPlotPointsPrompt()" title="Preview the prompt used to generate all plot points">
                            üîç Preview Plot Points Prompt
                        </button>
                        <span class="plot-info" style="margin-left: 10px; font-size: 0.9em; color: #666;">
                            Creates causal connections between scenes using "and then" / "therefore" logic
                        </span>
                    </div>

                    <p class="generation-info">
                        <strong>Tip:</strong> Generate plot points to create a strong narrative thread connecting your scenes with clear causal relationships.
                    </p>
                </div>
                
                <div id="scenesContent">
                    <!-- Generated scenes will appear here -->
                </div>
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="goToStep(3)">Back</button>
                    <button class="btn btn-primary" onclick="approveScenes()">Approve & Generate Dialogue</button>
                </div>
            </div>
        </section>

        <!-- Step 6: Dialogue Generation -->
        <section class="workflow-step" id="step6">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">Story Input</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(2)">Template</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(3)">Structure</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(4)">Plot Points</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(5)">Scenes</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <span class="breadcrumb-current">Dialogue</span>
                </div>
                <h2>Step 6: Generate Dialogue</h2>
                <p class="step-description">Generate and review dialogue for each scene:</p>
                <div id="dialogueContent">
                    <!-- Scene dialogue options will appear here -->
                </div>
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="goToStep(5)">Back</button>
                    <button class="btn btn-primary" onclick="finalizeScript()">Complete Script</button>
                </div>
            </div>
        </section>

        <!-- Step 7: Final Script & Export -->
        <section class="workflow-step" id="step7">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">Story Input</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(2)">Template</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(3)">Structure</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(4)">Plot Points</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(5)">Scenes</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(6)">Dialogue</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <span class="breadcrumb-current">Final Script</span>
                </div>
                <h2>Step 7: Final Script</h2>
                <p class="step-description">Your completed script is ready for export:</p>
                
                <div class="script-stats">
                    <div class="stat">
                        <span class="stat-label">Total Scenes:</span>
                        <span class="stat-value" id="totalScenes">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Estimated Pages:</span>
                        <span class="stat-value" id="estimatedPages">0</span>
                    </div>
                </div>

                <div class="script-preview" id="scriptPreview">
                    <!-- Final script preview -->
                </div>

                <div class="export-options">
                    <button class="btn btn-primary" onclick="exportScript('text')">Download Script (.txt)</button>
                    <button class="btn btn-outline" onclick="exportScript('json')">Export Project (.json)</button>
                    <button class="btn btn-outline" onclick="saveProject()">Save Project</button>
                </div>

                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="startOver()">Start New Script</button>
                </div>
            </div>
        </section>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
            <p class="loading-text" id="loadingText">Generating content...</p>
        </div>

        <!-- Load Project Modal -->
        <div class="modal" id="loadProjectModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Load Previous Project</h3>
                    <button class="modal-close" onclick="hideLoadProjectModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="projectsList">
                        <p>Loading projects...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Prompt Preview Modal -->
        <div class="modal" id="promptPreviewModal">
            <div class="modal-content prompt-modal">
                <div class="modal-header">
                    <h3>Prompt Preview & Editor</h3>
                    <div class="prompt-controls">
                        <button class="btn btn-outline btn-sm" onclick="toggleEditMode()">‚úèÔ∏è Edit</button>
                        <button class="btn btn-outline btn-sm" onclick="resetPrompt()">üîÑ Reset</button>
                        <button class="btn btn-success btn-sm" id="savePromptBtn" onclick="saveCustomPrompt()" style="display: none;">üíæ Save</button>
                    </div>
                    <button class="modal-close" onclick="hidePromptPreviewModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="customPromptNotice" class="custom-prompt-notice" style="display: none;">
                        <p>üé® <strong>Custom Prompt Active:</strong> You're using a modified version of the original prompt.</p>
                    </div>
                    
                    <div class="prompt-section">
                        <h4>System Message:</h4>
                        <div class="prompt-content" id="systemMessageContent"></div>
                        <textarea class="prompt-editor" id="systemMessageEditor" style="display: none;"></textarea>
                    </div>
                    <div class="prompt-section">
                        <h4>User Prompt:</h4>
                        <div class="prompt-content" id="userPromptContent"></div>
                        <textarea class="prompt-editor" id="userPromptEditor" style="display: none;"></textarea>
                    </div>
                    <div class="prompt-section">
                        <h4>Template Structure:</h4>
                        <div class="prompt-content" id="templateStructureContent"></div>
                        <textarea class="prompt-editor" id="templateStructureEditor" style="display: none;"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hidePromptPreviewModal()">Close</button>
                    <button class="btn btn-primary" onclick="generateWithCurrentPrompt()">Generate with this Prompt</button>
                </div>
            </div>
        </div>

        <!-- Scene Prompt Modal -->
        <div class="modal" id="scenePromptModal">
            <div class="modal-content prompt-modal">
                <div class="modal-header">
                    <h3>Scene Generation Prompt</h3>
                    <button class="modal-close" onclick="hideScenePromptModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="prompt-section">
                        <h4>System Message:</h4>
                        <div class="prompt-content" id="scenePromptSystemMessage"></div>
                    </div>
                    <div class="prompt-section">
                        <h4>User Prompt:</h4>
                        <div class="prompt-content" id="scenePromptUserPrompt"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideScenePromptModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Plot Point Prompt Modal -->
        <div class="modal" id="plotPointPromptModal">
            <div class="modal-content prompt-modal">
                <div class="modal-header">
                    <h3>Plot Point Generation Prompt</h3>
                    <button class="modal-close" onclick="hidePlotPointPromptModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="prompt-section">
                        <h4>System Message:</h4>
                        <div class="prompt-content" id="plotPointPromptSystemMessage"></div>
                    </div>
                    <div class="prompt-section">
                        <h4>User Prompt:</h4>
                        <div class="prompt-content" id="plotPointPromptUserPrompt"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hidePlotPointPromptModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Notification Toast -->
        <div class="toast" id="toast">
            <div class="toast-content">
                <span class="toast-message" id="toastMessage"></span>
                <button class="toast-close" onclick="hideToast()">&times;</button>
            </div>
        </div>
    </div>

    <script src="data-loader.js"></script>
    <script src="script.js"></script>
</body>
</html> 