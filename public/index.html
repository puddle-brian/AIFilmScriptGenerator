<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCREENPLAY GENIE</title>
    <link rel="stylesheet" href="styles.css?v=1.2">
    <link rel="stylesheet" href="credits.css?v=1.0">
    <link rel="stylesheet" href="credits-widget.css?v=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <!-- Top Row: Title and User Account Controls -->
            <div class="header-top">
                <div class="title-container">
                    <h1 class="title">SCREENPLAY GENIE</h1>
                    <img src="screenplayGenieLogoSmall_invert.png" alt="Screenplay Genie" class="logo">
                </div>
                
                <!-- User Account Controls -->
                <nav class="header-user-nav">
                    <!-- Guest Actions -->
                    <div class="guest-actions" id="guestActions">
                        <a href="login.html" class="nav-link">Sign In</a>
                        <a href="register.html" class="btn btn-primary btn-sm">Get Started</a>
                    </div>
                    
                    <!-- Authenticated User Controls -->
                    <div class="user-controls" id="userControls" style="display: none;">
                        <!-- Credits Display -->
                        <div class="credits-display" id="creditsDisplay">
                            <div class="credits-badge" id="creditsBadge">
                                <span class="credits-icon">üí≥</span>
                                <span class="credits-amount" id="creditsAmount">--</span>
                                <span class="credits-text">credits</span>
                            </div>
                            <div class="credits-tooltip" id="creditsTooltip">
                                <div class="tooltip-content">
                                    <div class="tooltip-row">
                                        <span>Current Balance:</span>
                                        <span id="tooltipBalance">--</span>
                                    </div>
                                    <div class="tooltip-row">
                                        <span>Last 7 days:</span>
                                        <span id="tooltipUsage">-- used</span>
                                    </div>
                                    <div class="tooltip-row">
                                        <span>Est. cost/generation:</span>
                                        <span id="tooltipEstimate">10-50 credits</span>
                                    </div>
                                    <div class="tooltip-action">
                                        <a href="profile.html#credits">Manage Credits ‚Üí</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Profile Dropdown -->
                        <div class="profile-dropdown" id="profileDropdown">
                            <button class="profile-trigger nav-link" id="profileTrigger" onclick="toggleProfileDropdown()">
                                <span id="userName">üë§ User</span>
                                <span class="dropdown-arrow">‚ñº</span>
                            </button>
                            <div class="profile-menu" id="profileMenu">
                                <div class="profile-menu-header">
                                    <span class="profile-username" id="profileUsername">User</span>
                                </div>
                                <div class="profile-menu-divider"></div>
                                <a href="profile.html" class="profile-menu-item">
                                    <span class="menu-icon">‚öôÔ∏è</span>
                                    Profile Settings
                                </a>
                                <div class="profile-menu-divider"></div>
                                <button class="profile-menu-item profile-signout" onclick="logout()">
                                    <span class="menu-icon">üö™</span>
                                    Sign Out
                                </button>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
            
            <!-- Bottom Row: Project Controls -->
            <div class="header-controls">
                <nav class="header-project-nav">
                    <!-- Global Project Controls -->
                    <div class="global-project-controls">
                        <!-- Model Selector -->
                        <div class="global-model-selector">
                            <select id="globalModelSelect" class="select-compact">
                                <option value="claude-sonnet-4-20250514">Claude Sonnet 4</option>
                                <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                                <option value="claude-3-5-haiku-20241022">Claude 3.5 Haiku</option>
                                <option value="claude-3-haiku-20240307">Claude 3 Haiku</option>
                            </select>
                        </div>
                        
                        <!-- Project Actions -->
                        <div class="global-project-actions">
                            <button class="btn btn-outline btn-xs" onclick="newProject()">‚ú® New</button>
                            <button class="btn btn-outline btn-xs" onclick="showLoadProjectModal()">üìÅ Load</button>
                            <button class="btn btn-outline btn-xs" onclick="saveProject()" id="globalSaveBtn" style="display: none;">üíæ Save</button>
                        </div>
                    </div>
                    
                    <!-- Save Status Indicator -->
                    <div id="saveStatus" class="save-status"></div>
                </nav>
            </div>
        </header>

        <!-- Progress Indicator -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-steps">
                <div class="step" data-step="1"><span>Story Input</span></div>
                <div class="step" data-step="2"><span>Template</span></div>
                <div class="step" data-step="3"><span>Acts</span></div>
                <div class="step" data-step="4"><span>Plot Points</span></div>
                <div class="step" data-step="5"><span>Scenes</span></div>
                <div class="step" data-step="6"><span>Dialogue</span></div>
                <div class="step" data-step="7"><span>Export</span></div>
            </div>
        </div>

        <!-- Step 1: Story Input -->
        <section class="workflow-step active" id="step1">
            <div class="card">
                <h2>Step 1: Story Concept & Influences</h2>
                <form id="storyForm">
                    <!-- Story Concept -->
                    <div class="form-group">
                        <label for="storyConceptSelect">Story Concept</label>
                        <div id="storyConceptSelector" class="influence-container">
                            <select id="storyConceptSelect" class="influence-select">
                                <option value="">Select or create a story concept...</option>
                                <!-- Options will be populated dynamically from story concept library -->
                            </select>
                            <button type="button" class="add-new-btn" onclick="addFromDropdownOrNew('storyconcept')" title="Load saved concept or create new">+ Add New</button>
                        </div>
                        <div id="storyConceptDisplay" class="story-concept-display" style="display: none;">
                            <!-- Selected story concept will be displayed here -->
                        </div>
                    </div>
                    
                    <!-- Main Characters -->
                    <div class="form-group">
                        <label for="mainCharacters">Main Characters</label>
                        <div class="influence-container">
                            <select id="characterSelect" class="influence-select">
                                <option value="">Select a character...</option>
                                <!-- Options will be populated dynamically from character library -->
                            </select>
                            <button type="button" class="add-new-btn" onclick="addFromDropdownOrNew('character')" title="Add from dropdown or create new">+ Add New</button>
                        </div>
                        <div id="characterTags" class="influence-tags"></div>
                    </div>

                    <!-- Director Influences -->
                    <div class="form-group">
                        <label for="directorInfluences">Directorial Style Influences</label>
                        <div class="influence-container">
                            <select id="directorSelect" class="influence-select">
                                <option value="">Select a director...</option>
                                <!-- Options will be populated dynamically from JSON -->
                            </select>
                            <button type="button" class="add-new-btn" onclick="addFromDropdownOrNew('director')" title="Add from dropdown or create new">+ Add New</button>
                        </div>
                        <div id="directorTags" class="influence-tags"></div>
                    </div>

                    <!-- Screenwriter Influences -->
                    <div class="form-group">
                        <label for="screenwriterInfluences">Screenwriter Influences</label>
                        <div class="influence-container">
                            <select id="screenwriterSelect" class="influence-select">
                                <option value="">Select a screenwriter...</option>
                                <!-- Options will be populated dynamically from JSON -->
                            </select>
                            <button type="button" class="add-new-btn" onclick="addFromDropdownOrNew('screenwriter')" title="Add from dropdown or create new">+ Add New</button>
                        </div>
                        <div id="screenwriterTags" class="influence-tags"></div>
                    </div>

                    <!-- Film Influences -->
                    <div class="form-group">
                        <label for="filmInfluences">Film Influences</label>
                        <div class="influence-container">
                            <select id="filmSelect" class="influence-select">
                                <option value="">Select a film...</option>
                                <!-- Options will be populated dynamically from JSON -->
                            </select>
                            <button type="button" class="add-new-btn" onclick="addFromDropdownOrNew('film')" title="Add from dropdown or create new">+ Add New</button>
                        </div>
                        <div id="filmTags" class="influence-tags"></div>
                    </div>

                    <!-- Tone/Style -->
                    <div class="form-group">
                        <label for="tone">Tone/Style</label>
                        <div class="influence-container">
                            <select id="tone" name="tone">
                                <option value="">Select tone</option>
                                <!-- Options will be populated dynamically from JSON -->
                            </select>
                            <button type="button" class="add-new-btn" onclick="addFromDropdownOrNew('tone')" title="Add from dropdown or create new">+ Add New</button>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="autoGenerate()">üé≤ Auto Generate (Debug)</button>
                        <button type="submit" class="btn btn-primary">Continue to Act Selection</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Step 2: Template Selection -->
        <section class="workflow-step" id="step2">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">‚Üê Story Input</button>
                    <span class="breadcrumb-current">Template Selection</span>
                </div>
                <h2>Step 2: Choose Template</h2>
                <p class="step-description" id="templateStepDescription">Select a story structure template that best fits your narrative:</p>
                
                <!-- Selected Template Display (Expanded State) -->
                <div class="selected-template-display" id="selectedTemplateDisplay" style="display: none;">
                    <div class="template-info-card selected-template-card">
                        <div class="selected-template-header">
                            <div class="selected-template-info">
                                <h3 id="selectedTemplateName">Template Name</h3>
                                <p class="template-description" id="selectedTemplateDescription">Template description</p>
                                <div class="template-category" id="selectedTemplateCategory">Category</div>
                            </div>
                            <div class="selected-template-actions">
                                <button class="btn btn-outline btn-sm" onclick="changeTemplate()">
                                    ‚Üª Change Template
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="templateOptions">
                    <!-- Templates will be loaded here -->
                </div>
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="goToStep(1)">Back</button>
                    <button class="btn btn-primary" id="selectTemplateBtn" disabled onclick="goToNextStep()">Continue to Acts</button>
                </div>
            </div>
        </section>

        <!-- Step 3: Acts Review -->
        <section class="workflow-step" id="step3">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">Story Input</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(2)">Template</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <span class="breadcrumb-current">Acts Generation</span>
                </div>
                <h2>Step 3: Generate Story Acts</h2>
                <p class="step-description">Generate story acts using your selected template:</p>
                
                <!-- Acts Generation Options -->
                <div class="acts-generation-options" id="actsGenerationOptions" style="margin-bottom: 20px;">
                    <div class="acts-generation-section" style="margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="generateStructure()" title="Generate story acts using the selected template">
                            üìã Generate Acts
                        </button>
                        <button class="btn btn-outline" onclick="previewPrompt()" title="Preview the prompt used to generate acts">
                            üîç Preview Acts Prompt
                        </button>
                        <span class="acts-info" style="margin-left: 10px; font-size: 0.9em; color: #666;">
                            Creates structured story acts based on your selected template
                        </span>
                    </div>

                    <p class="generation-info">
                        <strong>Tip:</strong> Generate acts to create the structural foundation for your story before developing plot points and scenes.
                    </p>
                </div>
                
                <div id="structureContent">
                    <!-- Generated structure will appear here -->
                </div>
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="goToStep(2)">Back</button>
                    <button class="btn btn-outline" onclick="regenerateStructure()" id="regenerateBtn" style="display: none;">Regenerate</button>
                    <button class="btn btn-primary" onclick="approveStructure()" id="approveBtn" style="display: none;">Approve & Continue to Plot Points</button>
                </div>
            </div>
        </section>

        <!-- Step 4: Plot Points Generation -->
        <section class="workflow-step" id="step4">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">Story Input</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(2)">Template</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(3)">Acts</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <span class="breadcrumb-current">Plot Points</span>
                </div>
                <h2>Step 4: Generate Plot Points</h2>
                <p class="step-description">Generate causal plot points for each story act. These will guide the scene creation process.</p>
                
                <!-- Plot Points Generation Options -->
                <div class="plot-generation-options" id="plotGenerationOptions" style="margin-bottom: 20px;">
                    <div class="plot-generation-section" style="margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="generateAllPlotPoints()" title="Generate connected plot points for all scenes">
                            üìã Generate All Plot Points
                        </button>
                        <button class="btn btn-outline" onclick="previewAllPlotPointsPrompt()" title="Preview the prompt used to generate all plot points">
                            üîç Preview Plot Points Prompt
                        </button>
                        <span class="plot-info" style="margin-left: 10px; font-size: 0.9em; color: #666;">
                            Creates causal connections between scenes using "but" / "therefore" logic
                        </span>
                    </div>

                    <p class="generation-info">
                        <strong>Tip:</strong> Generate plot points to create a strong narrative thread connecting your scenes with clear causal relationships.
                    </p>
                </div>
                
                <div id="plotPointsContent">
                    <!-- Plot points will be generated here -->
                </div>
                
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="goToStep(3)">Back</button>
                    <button class="btn btn-primary" onclick="goToStep(5)">Continue to Scenes</button>
                </div>
            </div>
        </section>

        <!-- Step 5: Scenes Review -->
        <section class="workflow-step" id="step5">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">Story Input</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(2)">Template</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(3)">Acts</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(4)">Plot Points</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <span class="breadcrumb-current">Scenes</span>
                </div>
                <h2>Step 5: Generate Scenes</h2>
                <p class="step-description">Generate scenes for each story act using the plot points as guidance.</p>
                
                <!-- Scene Configuration -->
                <div class="form-group" style="max-width: 300px; margin-bottom: 1.5rem;">
                    <label for="totalScenes">Total Scenes Target</label>
                    <input type="number" id="totalScenes" name="totalScenes" value="70" min="20" max="150" required>
                    <small class="form-help">Target number of scenes for the entire script (used for generation calculations)</small>
                </div>
                
                <!-- Scenes Generation Options -->
                <div class="scenes-generation-options" id="scenesGenerationOptions" style="margin-bottom: 20px;">
                    <div class="scenes-generation-section" style="margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="generateAllScenes()" title="Generate scenes for all acts that have plot points">
                            üé¨ Generate All Scenes
                        </button>
                        <button class="btn btn-outline" onclick="previewAllScenesPrompt()" title="Preview the prompts used to generate all scenes">
                            üîç Preview All Scenes Prompts
                        </button>
                        <span class="scenes-info" style="margin-left: 10px; font-size: 0.9em; color: #666;">
                            Creates scenes based on the plot points from each story act
                        </span>
                    </div>

                    <p class="generation-info">
                        <strong>Tip:</strong> Scenes will only be generated for acts that have plot points. Complete Step 4 first to ensure all acts have plot points.
                    </p>
                </div>
                
                <div id="scenesContent">
                    <!-- Generated scenes will appear here -->
                </div>
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="goToStep(3)">Back</button>
                    <button class="btn btn-primary" onclick="approveScenes()">Approve & Generate Dialogue</button>
                </div>
            </div>
        </section>

        <!-- Step 6: Dialogue Generation -->
        <section class="workflow-step" id="step6">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">Story Input</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(2)">Template</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(3)">Acts</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(4)">Plot Points</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(5)">Scenes</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <span class="breadcrumb-current">Dialogue</span>
                </div>
                <h2>Step 6: Generate Dialogue</h2>
                <p class="step-description">Generate and review dialogue for each scene:</p>
                
                <!-- Dialogue Generation Options -->
                <div class="dialogue-generation-options" id="dialogueGenerationOptions" style="margin-bottom: 20px;">
                    <div class="dialogue-generation-section" style="margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="generateAllDialogue()" title="Generate dialogue for all scenes that exist">
                            üí¨ Generate All Dialogue
                        </button>
                        <button class="btn btn-outline" onclick="previewAllDialoguePrompts()" title="Preview the prompts used to generate all dialogue">
                            üîç Preview All Dialogue Prompts
                        </button>
                        <span class="dialogue-info" style="margin-left: 10px; font-size: 0.9em; color: #666;">
                            Creates professional dialogue for all generated scenes
                        </span>
                    </div>

                    <p class="generation-info">
                        <strong>Tip:</strong> Dialogue will only be generated for scenes that exist. Complete Step 5 first to ensure all acts have scenes.
                    </p>
                </div>
                
                <div id="dialogueContent">
                    <!-- Scene dialogue options will appear here -->
                </div>
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="goToStep(5)">Back</button>
                    <button class="btn btn-primary" onclick="finalizeScript()">View Final Script</button>
                </div>
            </div>
        </section>

        <!-- Step 7: Final Script & Export -->
        <section class="workflow-step" id="step7">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">Story Input</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(2)">Template</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(3)">Acts</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(4)">Plot Points</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(5)">Scenes</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(6)">Dialogue</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <span class="breadcrumb-current">Final Script</span>
                </div>
                <h2>Step 7: Final Script</h2>
                <p class="step-description">Your completed script is ready for export:</p>
                
                <div class="script-stats">
                    <div class="stat">
                        <span class="stat-label">Scenes with Dialogue:</span>
                        <span class="stat-value" id="totalScenesDisplay">0/0 scenes</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Estimated Pages:</span>
                        <span class="stat-value" id="estimatedPagesDisplay">0</span>
                    </div>
                </div>

                <div class="script-preview" id="scriptPreview">
                    <!-- Final script preview -->
                </div>

                <div class="export-options">
                    <h3>üé¨ Professional Export Options</h3>
                    <div class="export-formats">
                        <div class="export-category">
                            <h4>üìÑ Industry Standard Formats</h4>
                            <button class="btn btn-primary" onclick="exportScript('screenplay')">
                                üìù Professional Screenplay (.txt)
                            </button>
                            <button class="btn btn-outline" onclick="exportScript('fountain')">
                                ‚õ≤ Fountain Format (.fountain)
                            </button>
                            <button class="btn btn-outline" onclick="exportScript('fdx')">
                                üé≠ Final Draft (.fdx)
                            </button>
                        </div>
                        
                        <div class="export-category">
                            <h4>üì¶ Production Ready</h4>
                            <button class="btn btn-success" onclick="exportScript('production')">
                                üé¨ Production Package
                            </button>
                            <button class="btn btn-outline" onclick="exportScript('pdf-ready')">
                                üìÑ PDF-Ready Format
                            </button>
                        </div>
                        
                        <div class="export-category">
                            <h4>üíæ Project Files</h4>
                            <button class="btn btn-outline" onclick="exportScript('json')">
                                üìÅ Export Project (.json)
                            </button>
                            <button class="btn btn-outline" onclick="saveProject()">
                                üíæ Save Project
                            </button>
                        </div>
                    </div>
                    
                    <div class="export-info">
                        <p><strong>üìã Format Guide:</strong></p>
                        <ul>
                            <li><strong>Professional Screenplay:</strong> Industry-standard formatting with proper margins and spacing</li>
                            <li><strong>Fountain:</strong> Plain-text markup language readable by most screenwriting software</li>
                            <li><strong>Final Draft:</strong> XML format compatible with Final Draft software</li>
                            <li><strong>Production Package:</strong> Complete package with script, character breakdown, and production notes</li>
                            <li><strong>PDF-Ready:</strong> Formatted for easy conversion to PDF with proper page breaks</li>
                        </ul>
                    </div>
                </div>

                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="startOver()">Start New Script</button>
                </div>
            </div>
        </section>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
            <p class="loading-text" id="loadingText">Generating content...</p>
        </div>

        <!-- Load Project Modal -->
        <div class="modal" id="loadProjectModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Load Previous Project</h3>
                    <button class="modal-close" onclick="hideLoadProjectModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="projectsList">
                        <p>Loading projects...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Prompt Preview Modal -->
        <div class="modal" id="promptPreviewModal">
            <div class="modal-content prompt-modal">
                <div class="modal-header">
                    <h3>Prompt Preview & Editor</h3>
                    <div class="prompt-controls">
                        <button class="btn btn-outline btn-sm" onclick="toggleEditMode()">‚úèÔ∏è Edit</button>
                        <button class="btn btn-outline btn-sm" onclick="resetPrompt()">üîÑ Reset</button>
                        <button class="btn btn-success btn-sm" id="savePromptBtn" onclick="saveCustomPrompt()" style="display: none;">üíæ Save</button>
                    </div>
                    <button class="modal-close" onclick="hidePromptPreviewModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="customPromptNotice" class="custom-prompt-notice" style="display: none;">
                        <p>üé® <strong>Custom Prompt Active:</strong> You're using a modified version of the original prompt.</p>
                    </div>
                    
                    <div class="prompt-section">
                        <h4>System Message:</h4>
                        <div class="prompt-content" id="systemMessageContent"></div>
                        <textarea class="prompt-editor" id="systemMessageEditor" style="display: none;"></textarea>
                    </div>
                    <div class="prompt-section">
                        <h4>User Prompt:</h4>
                        <div class="prompt-content" id="userPromptContent"></div>
                        <textarea class="prompt-editor" id="userPromptEditor" style="display: none;"></textarea>
                    </div>
                    <div class="prompt-section">
                        <h4>Template Structure:</h4>
                        <div class="prompt-content" id="templateStructureContent"></div>
                        <textarea class="prompt-editor" id="templateStructureEditor" style="display: none;"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hidePromptPreviewModal()">Close</button>
                    <button class="btn btn-primary" onclick="generateWithCurrentPrompt()">Generate with this Prompt</button>
                </div>
            </div>
        </div>

        <!-- Scene Prompt Modal -->
        <div class="modal" id="scenePromptModal">
            <div class="modal-content prompt-modal">
                <div class="modal-header">
                    <h3>Scene Generation Prompt</h3>
                    <button class="modal-close" onclick="hideScenePromptModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="prompt-section">
                        <h4>System Message:</h4>
                        <div class="prompt-content" id="scenePromptSystemMessage"></div>
                    </div>
                    <div class="prompt-section">
                        <h4>User Prompt:</h4>
                        <div class="prompt-content" id="scenePromptUserPrompt"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideScenePromptModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Plot Point Prompt Modal -->
        <div class="modal" id="plotPointPromptModal">
            <div class="modal-content prompt-modal">
                <div class="modal-header">
                    <h3>Plot Point Generation Prompt</h3>
                    <button class="modal-close" onclick="hidePlotPointPromptModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="prompt-section">
                        <h4>System Message:</h4>
                        <div class="prompt-content" id="plotPointPromptSystemMessage"></div>
                    </div>
                    <div class="prompt-section">
                        <h4>User Prompt:</h4>
                        <div class="prompt-content" id="plotPointPromptUserPrompt"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hidePlotPointPromptModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Individual Plot Point Prompt Modal -->
        <div class="modal" id="individualPlotPointPromptModal">
            <div class="modal-content prompt-modal">
                <div class="modal-header">
                    <h3>Individual Plot Point Regeneration Prompt</h3>
                    <button class="modal-close" onclick="hideIndividualPlotPointPromptModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="prompt-section">
                        <h4>System Message:</h4>
                        <div class="prompt-content" id="individualPlotPointPromptSystemMessage"></div>
                    </div>
                    <div class="prompt-section">
                        <h4>User Prompt:</h4>
                        <div class="prompt-content" id="individualPlotPointPromptUserPrompt"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideIndividualPlotPointPromptModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Dialogue Prompt Modal -->
        <div class="modal" id="dialoguePromptModal">
            <div class="modal-content prompt-modal">
                <div class="modal-header">
                    <h3>Dialogue Generation Prompt</h3>
                    <button class="modal-close" onclick="hideDialoguePromptModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="prompt-section">
                        <h4>System Message:</h4>
                        <div class="prompt-content" id="dialoguePromptSystemMessage"></div>
                    </div>
                    <div class="prompt-section">
                        <h4>User Prompt:</h4>
                        <div class="prompt-content" id="dialoguePromptUserPrompt"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideDialoguePromptModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Project Header (shown when project is loaded) - Moved to bottom -->
        <div class="project-header" id="projectHeader" style="display: none;">
            <div class="project-info">
                <div class="project-title-section">
                    <h2 class="project-title" id="projectTitle">Project Title</h2>
                    <span class="project-status" id="projectStatus">Working on Acts</span>
                </div>
                <div class="project-meta">
                    <span class="project-template" id="projectTemplate">Template: Three-Act Structure</span>
                    <span class="project-separator">‚Ä¢</span>
                    <span class="project-scenes" id="projectScenes">70 scenes</span>
                    <span class="project-separator">‚Ä¢</span>
                    <span class="project-id" id="projectId">ID: abc123</span>
                </div>
            </div>
            <div class="project-actions">
                <div class="model-selector">
                    <label for="modelSelect" class="model-label">AI Model:</label>
                    <select id="modelSelect" class="select select-bordered w-full">
                        <option value="claude-sonnet-4-20250514">Claude Sonnet 4 (Latest & Best)</option>
                        <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet (Best Quality)</option>
                        <option value="claude-3-5-haiku-20241022">Claude 3.5 Haiku (Fast & Cheap)</option>
                        <option value="claude-3-haiku-20240307">Claude 3 Haiku (Cheapest)</option>
                    </select>
                    <div class="model-info">
                        <span class="model-cost" id="modelCost">~$3/$15 per million tokens</span>
                    </div>
                </div>
                <button class="btn btn-sm btn-primary" onclick="newProject()">‚ú® New Project</button>
                <button class="btn btn-sm btn-outline" onclick="showLoadProjectModal()">üìÅ Load Project</button>
                <button class="btn btn-sm btn-outline" onclick="showProjectDetails()">üìã Details</button>
                <button class="btn btn-sm btn-secondary" onclick="saveProject()">üíæ Save</button>
            </div>
        </div>

        <!-- Add Character Modal -->
        <div class="modal" id="addCharacterModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="characterModalTitle">Add Character</h3>
                    <button class="modal-close" onclick="hideCharacterModal()">&times;</button>
                </div>
                <form id="characterForm">
                    <div class="form-group">
                        <label for="characterName">Character Name</label>
                        <input type="text" id="characterName" name="characterName" required 
                               placeholder="e.g., Sarah Connor">
                    </div>
                    
                    <div class="form-group">
                        <label for="characterDescription">Character Description</label>
                        <textarea id="characterDescription" name="characterDescription" required rows="4"
                                  placeholder="Describe the character's role, personality, background, and psychological/social context..."></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="hideCharacterModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Character</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Select Character from Library Modal -->
        <div class="modal" id="characterLibraryModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add Character from Library</h3>
                    <button class="modal-close" onclick="hideCharacterLibraryModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="characterLibraryList">
                        <p>Loading character library...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideCharacterLibraryModal()">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Notification Toast -->
        <div class="toast" id="toast">
            <div class="toast-content">
                <span class="toast-message" id="toastMessage"></span>
                <button class="toast-close" onclick="hideToast()">&times;</button>
            </div>
        </div>
    </div>

    <script src="data-loader.js"></script>
    <script src="credits.js?v=1.0"></script>
    <script src="credits-widget.js?v=1.0"></script>
    <script src="script.js?v=1.3"></script>
</body>
</html> 
