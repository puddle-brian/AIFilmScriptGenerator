<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Screenplay Genie - AI Film Script Generator | Create Feature-Length Screenplays in Minutes</title>
    <meta name="description" content="Generate professional feature-length screenplays instantly with AI. Create compelling movie scripts with structured plot points, scenes, and dialogue. Free 100 credits to start!">
    <meta name="keywords" content="screenplay generator, script writer, AI screenwriting, film script, movie script generator, screenplay software, script writing tool, screenwriter AI">
    <meta name="author" content="Screenplay Genie">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://screenplaygenie.com/">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://screenplaygenie.com/">
    <meta property="og:title" content="Screenplay Genie - AI Film Script Generator">
    <meta property="og:description" content="Generate professional feature-length screenplays instantly with AI. Create compelling movie scripts with structured plot points, scenes, and dialogue.">
    <meta property="og:image" content="https://screenplaygenie.com/screenplayGenieLogoSmall.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Screenplay Genie - AI Film Script Generator">
    <meta property="og:site_name" content="Screenplay Genie">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://screenplaygenie.com/">
    <meta name="twitter:title" content="Screenplay Genie - AI Film Script Generator">
    <meta name="twitter:description" content="Generate professional feature-length screenplays instantly with AI. Create compelling movie scripts in minutes.">
    <meta name="twitter:image" content="https://screenplaygenie.com/screenplayGenieLogoSmall.png">
    <meta name="twitter:image:alt" content="Screenplay Genie - AI Film Script Generator">
    <meta name="twitter:creator" content="@ScreenplayGenie">
    <meta name="twitter:site" content="@ScreenplayGenie">
    
    <!-- Additional SEO -->
    <meta name="theme-color" content="#10b981">
    <meta name="apple-mobile-web-app-title" content="Screenplay Genie">
    <meta name="application-name" content="Screenplay Genie">
    <meta name="msapplication-TileColor" content="#10b981">
    
    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Screenplay Genie",
      "description": "AI-powered film script generator that creates professional feature-length screenplays with structured plot points, scenes, and dialogue",
      "url": "https://screenplaygenie.com",
      "applicationCategory": "CreativeWork",
      "operatingSystem": "Any",
      "browser": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD",
        "description": "Free trial with 100 credits included"
      },
      "creator": {
        "@type": "Organization",
        "name": "Screenplay Genie",
        "url": "https://screenplaygenie.com"
      },
      "featureList": [
        "AI-powered screenplay generation",
        "Multiple story structure templates",
        "Professional formatting",
        "Export to multiple formats",
        "Character and plot development",
        "Scene and dialogue generation"
      ],
      "screenshot": "https://screenplaygenie.com/screenplayGenieLogoSmall.png",
      "softwareVersion": "1.0",
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "ratingCount": "150"
      }
    }
    </script>
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/screenplayGenieLogoSmall.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/screenplayGenieLogoSmall.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/screenplayGenieLogoSmall.png">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="styles.css?v=1.2">
    <link rel="stylesheet" href="credits.css?v=1.0">
    <link rel="stylesheet" href="credits-widget.css?v=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <!-- Top Row: Title and User Account Controls -->
            <div class="header-top">
                <div class="title-container">
                    <div class="title-section">
                        <h1 class="title">SCREENPLAY GENIE</h1>
                        <p class="subtitle">Create a feature-length screenplay in minutes</p>
                    </div>
                    <img src="screenplayGenieLogoSmall_invert.png" alt="Screenplay Genie" class="logo">
                </div>
                
                <!-- User Account Controls -->
                <nav class="header-user-nav">
                    <!-- Guest Actions -->
                    <div class="guest-actions" id="guestActions">
                        <a href="login.html" class="nav-link">Sign In</a>
                        <a href="register.html" class="btn btn-primary btn-sm">Get Started</a>
                    </div>
                    
                    <!-- Authenticated User Controls -->
                    <div class="user-controls" id="userControls" style="display: none;">
                        <!-- Model Selector -->
                        <div class="header-model-selector">
                            <select id="globalModelSelect" class="select-compact">
                                <option value="claude-sonnet-4-20250514">Claude Sonnet 4</option>
                                <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                                <option value="claude-3-5-haiku-20241022">Claude 3.5 Haiku</option>
                                <option value="claude-3-haiku-20240307">Claude 3 Haiku</option>
                            </select>
                        </div>
                        
                        <!-- Credits Display -->
                        <div class="credits-display" id="creditsDisplay">
                            <div class="credits-badge clickable" id="creditsBadge" onclick="window.location.href='buy-credits.html'" title="Click to manage credits">
                                <span class="credits-icon">üí≥</span>
                                <span class="credits-amount" id="creditsAmount">--</span>
                                <span class="credits-text">credits</span>
                            </div>
                            <div class="credits-tooltip" id="creditsTooltip">
                                <div class="tooltip-content">
                                    <div class="tooltip-row">
                                        <span>Current Balance:</span>
                                        <span id="tooltipBalance">--</span>
                                    </div>
                                    <div class="tooltip-row">
                                        <span>Last 7 days:</span>
                                        <span id="tooltipUsage">-- used</span>
                                    </div>
                                    <div class="tooltip-row">
                                        <span>Est. cost/generation:</span>
                                        <span id="tooltipEstimate">10-50 credits</span>
                                    </div>
                                    <div class="tooltip-action">
                                        <a href="buy-credits.html">üí≥ Manage Credits ‚Üí</a>
                                        <div class="tooltip-hint">üí° Click badge to manage credits</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Buy Credits Button -->
                        <div class="buy-credits-button" id="buyCreditsButton">
                            <a href="buy-credits.html" class="btn btn-primary btn-sm">üí≥ Buy Credits</a>
                        </div>
                        
                        <!-- Admin Button (only shown to admins) -->
                        <div class="admin-access" id="adminAccess" style="display: none;">
                            <a href="admin.html" class="admin-btn" title="Admin Panel">‚öôÔ∏è</a>
                        </div>
                        
                        <!-- Profile Dropdown -->
                        <div class="profile-dropdown" id="profileDropdown">
                            <button class="profile-trigger nav-link" id="profileTrigger" onclick="toggleProfileDropdown()">
                                <span id="userName">User</span>
                                <span class="dropdown-arrow">‚ñº</span>
                            </button>
                            <div class="profile-menu" id="profileMenu">
                                <div class="profile-menu-header">
                                    <span class="profile-username" id="profileUsername">User</span>
                                </div>
                                <div class="profile-menu-divider"></div>
                                <a href="profile.html" class="profile-menu-item">
                                    My Profile
                                </a>
                                <a href="buy-credits.html" class="profile-menu-item">
                                    üí≥ Buy Credits
                                </a>
                                <div class="profile-menu-divider"></div>
                                <button class="profile-menu-item profile-signout" onclick="logout()">
                                    Sign Out
                                </button>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
            
            <!-- Bottom Row: Project Controls -->
            <div class="header-controls">
                <nav class="header-project-nav">
                    <!-- Global Project Controls -->
                    <div class="global-project-controls">
                        <!-- Project Actions -->
                        <div class="global-project-actions">
                            <button class="btn btn-outline btn-xs" onclick="newProject()">New Project</button>
                            <button class="btn btn-outline btn-xs" onclick="showLoadProjectModal()">Load Project</button>
                            <button class="btn btn-outline btn-xs" onclick="saveProject()" id="globalSaveBtn" style="display: none;">Save Project</button>
                        </div>
                    </div>
                    
                    <!-- Save Status Indicator -->
                    <div id="saveStatus" class="save-status"></div>
                </nav>
                
                <!-- Current Project Indicator - Centered Below -->
                <div class="current-project-indicator" id="currentProjectIndicator" style="display: none;">
                    <span class="project-label">Project:</span>
                    <span class="project-name" id="currentProjectName">No Project</span>
                </div>
            </div>
        </header>

        <!-- Progress Indicator -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-steps">
                <div class="step" data-step="1"><span>Story Input</span></div>
                <div class="step" data-step="2"><span>Template</span></div>
                <div class="step" data-step="3"><span>Acts</span></div>
                <div class="step" data-step="4"><span>Plot Points</span></div>
                <div class="step" data-step="5"><span>Scenes</span></div>
                <div class="step" data-step="6"><span>Dialogue</span></div>
                <div class="step" data-step="7"><span>Export</span></div>
            </div>
        </div>

        <!-- Step 1: Story Input -->
        <section class="workflow-step" id="step1">
            <div class="card">
                <h2>Step 1: Story Concept & Influences
                    <div class="progress-meter" data-step="1">
                        <svg viewBox="0 0 40 40">
                            <circle class="progress-bg" cx="20" cy="20" r="16"></circle>
                            <circle class="progress-fill" cx="20" cy="20" r="16" 
                                    stroke-dasharray="0 100.48" stroke-dashoffset="0"></circle>
                        </svg>
                        <div class="progress-text">0%</div>
                    </div>
                </h2>
                <form id="storyForm">
                    <!-- Story Concept -->
                    <div class="form-group">
                        <label for="storyConceptSelect">Story Concept</label>
                        <div id="storyConceptSelector" class="influence-container">
                            <select id="storyConceptSelect" class="influence-select">
                                <option value="">Select or create a story concept...</option>
                                <!-- Options will be populated dynamically from story concept library -->
                            </select>
                            <button type="button" class="add-new-btn" onclick="addFromDropdownOrNew('storyconcept')" title="Load saved concept or create new">+ Add New</button>
                        </div>
                        <div id="storyConceptDisplay" class="story-concept-display" style="display: none;">
                            <!-- Selected story concept will be displayed here -->
                        </div>
                    </div>
                    
                    <!-- Main Characters -->
                    <div class="form-group">
                        <label for="mainCharacters">Main Characters</label>
                        <div class="influence-container">
                            <select id="characterSelect" class="influence-select">
                                <option value="">Select a character...</option>
                                <!-- Options will be populated dynamically from character library -->
                            </select>
                            <button type="button" class="add-new-btn" onclick="addFromDropdownOrNew('character')" title="Add from dropdown or create new">+ Add New</button>
                        </div>
                        <div id="characterTags" class="influence-tags"></div>
                    </div>

                    <!-- Director Influences -->
                    <div class="form-group">
                        <label for="directorInfluences">Direction reminiscent of...</label>
                        <div class="influence-container">
                            <select id="directorSelect" class="influence-select">
                                <option value="">Anything that captures the style...</option>
                                <!-- Options will be populated dynamically from JSON -->
                            </select>
                            <button type="button" class="add-new-btn" onclick="addFromDropdownOrNew('director')" title="Add from dropdown or create new">+ Add New</button>
                        </div>
                        <div id="directorTags" class="influence-tags"></div>
                    </div>

                    <!-- Screenwriter Influences -->
                    <div class="form-group">
                        <label for="screenwriterInfluences">Prose style that invokes...</label>
                        <div class="influence-container">
                            <select id="screenwriterSelect" class="influence-select">
                                <option value="">Anything that captures the voice...</option>
                                <!-- Options will be populated dynamically from JSON -->
                            </select>
                            <button type="button" class="add-new-btn" onclick="addFromDropdownOrNew('screenwriter')" title="Add from dropdown or create new">+ Add New</button>
                        </div>
                        <div id="screenwriterTags" class="influence-tags"></div>
                    </div>

                    <!-- Film Influences -->
                    <div class="form-group">
                        <label for="filmInfluences">Channeling the essence of...</label>
                        <div class="influence-container">
                            <select id="filmSelect" class="influence-select">
                                <option value="">Anything that captures the feeling...</option>
                                <!-- Options will be populated dynamically from JSON -->
                            </select>
                            <button type="button" class="add-new-btn" onclick="addFromDropdownOrNew('film')" title="Add from dropdown or create new">+ Add New</button>
                        </div>
                        <div id="filmTags" class="influence-tags"></div>
                    </div>

                    <!-- Tone/Style -->
                    <div class="form-group">
                        <label for="toneInfluences">Tone and atmosphere inspired by...</label>
                        <div class="influence-container">
                            <select id="toneSelect" class="influence-select">
                                <option value="">Anything that captures the mood...</option>
                                <!-- Options will be populated dynamically from JSON -->
                            </select>
                            <button type="button" class="add-new-btn" onclick="addFromDropdownOrNew('tone')" title="Add from dropdown or create new">+ Add New</button>
                        </div>
                        <div id="toneTags" class="influence-tags"></div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="autoGenerate()" id="autoGenerateBtn" style="display: none;">üé≤ Auto Generate (Debug)</button>
                        <div class="genie-button-container" style="display: none;" id="genieContainer">
                            <img src="/askthegenie_black.png" alt="Story Critique by The Genie" class="genie-icon-large">
                            <button type="button" class="btn btn-genie" onclick="analyzeStoryConcept()" id="analyzeBtn">
                                Story Critique by The Genie
                            </button>
                        </div>
                    </div>
                </form>
                
                <!-- Story Critique Display -->
                <div id="storyAnalysisResults" class="story-analysis-results" style="display: none;">
                    <div class="analysis-header">
                        <div class="analysis-title-container">
                            <img src="/askthegenie_black.png" alt="The Genie" class="genie-icon-header">
                            <h3>The Genie's Verdict</h3>
                        </div>
                        <button type="button" class="close-analysis-btn" onclick="hideStoryAnalysis()">√ó</button>
                    </div>
                    <div id="analysisContent" class="analysis-content">
                        <!-- Analysis results will be populated here -->
                    </div>
                </div>
                
                <div class="step-actions">
                    <!-- Universal navigation buttons will be added here dynamically -->
                </div>
            </div>
        </section>

        <!-- Step 2: Template Selection -->
        <section class="workflow-step" id="step2">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">‚Üê Story Input</button>
                    <span class="breadcrumb-current">Template Selection</span>
                </div>
                <h2>Step 2: Choose Template
                    <div class="progress-meter" data-step="2">
                        <svg viewBox="0 0 40 40">
                            <circle class="progress-bg" cx="20" cy="20" r="16"></circle>
                            <circle class="progress-fill" cx="20" cy="20" r="16" 
                                    stroke-dasharray="0 100.48" stroke-dashoffset="0"></circle>
                        </svg>
                        <div class="progress-text">0%</div>
                    </div>
                </h2>
                <p class="step-description" id="templateStepDescription">Select a story structure template that best fits your narrative:</p>
                
                <!-- Selected Template Display (Expanded State) -->
                <div class="selected-template-display" id="selectedTemplateDisplay" style="display: none;">
                    <div class="template-info-card selected-template-card">
                        <div class="selected-template-header">
                            <div class="selected-template-info">
                                <h3 id="selectedTemplateName">Template Name</h3>
                                <p class="template-description" id="selectedTemplateDescription">Template description</p>
                                <div class="template-category" id="selectedTemplateCategory">Category</div>
                            </div>
                            <div class="selected-template-actions">
                                <button class="btn btn-outline btn-sm" onclick="changeTemplate()">
                                    ‚Üª Change Template
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- NEW: Act Cards Container -->
                    <div class="act-cards-container" id="actCardsContainer" style="display: none;">
                        <div class="act-cards-header">
                            <h4>Template Structure</h4>
                            <p class="act-cards-description">This template contains the following acts:</p>
                        </div>
                        <div class="act-cards-scroll" id="actCardsScroll">
                            <!-- Act cards will be populated here -->
                        </div>
                    </div>
                </div>
                
                <div id="templateOptions">
                    <!-- Templates will be loaded here -->
                </div>
                <div class="step-actions">
                    <!-- Universal navigation buttons will be added here dynamically -->
                </div>
            </div>
        </section>

        <!-- Step 3: Acts Review -->
        <section class="workflow-step" id="step3">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">Story Input</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(2)">Template</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <span class="breadcrumb-current">Acts Generation</span>
                </div>
                <h2>Step 3: Generate Story Acts
                    <div class="progress-meter" data-step="3">
                        <svg viewBox="0 0 40 40">
                            <circle class="progress-bg" cx="20" cy="20" r="16"></circle>
                            <circle class="progress-fill" cx="20" cy="20" r="16" 
                                    stroke-dasharray="0 100.48" stroke-dashoffset="0"></circle>
                        </svg>
                        <div class="progress-text">0%</div>
                    </div>
                </h2>
                <p class="step-description">Generate story acts using your selected template:</p>
                
                <!-- Acts Generation Options -->
                <div class="acts-generation-options" id="actsGenerationOptions" style="margin-bottom: 20px;">
                    <div class="acts-generation-section" style="margin-bottom: 15px;">
                        <button class="btn btn-generate-all" id="generateActsBtn" onclick="generateStructure()" title="Generate story acts using the selected template">
                            üìã Generate Acts
                        </button>
                        <button class="btn btn-outline" onclick="previewPrompt()" title="Preview the prompt used to generate acts">
                            üîç Preview Acts Prompt
                        </button>
                        <span class="acts-info" style="margin-left: 10px; font-size: 0.9em; color: #666;">
                            Creates structured story acts based on your selected template
                        </span>
                    </div>

                    <p class="generation-info">
                        <strong>Tip:</strong> Generate acts to create the structural foundation for your story before developing plot points and scenes.
                    </p>
                </div>
                
                <div id="structureContent">
                    <!-- Generated structure will appear here -->
                </div>
                <div class="step-actions">
                    <!-- Universal navigation buttons will be added here dynamically -->
                    <button class="btn btn-outline" onclick="regenerateStructure()" id="regenerateBtn" style="display: none;">Regenerate</button>
                </div>
            </div>
        </section>

        <!-- Step 4: Plot Points Generation -->
        <section class="workflow-step" id="step4">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">Story Input</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(2)">Template</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(3)">Acts</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <span class="breadcrumb-current">Plot Points</span>
                </div>
                <h2>Step 4: Generate Plot Points
                    <div class="progress-meter" data-step="4">
                        <svg viewBox="0 0 40 40">
                            <circle class="progress-bg" cx="20" cy="20" r="16"></circle>
                            <circle class="progress-fill" cx="20" cy="20" r="16" 
                                    stroke-dasharray="0 100.48" stroke-dashoffset="0"></circle>
                        </svg>
                        <div class="progress-text">0%</div>
                    </div>
                </h2>
                <p class="step-description">Generate causal plot points for each story act. These will guide the scene creation process.</p>
                
                <!-- Plot Points Generation Options -->
                <div class="plot-generation-options" id="plotGenerationOptions" style="margin-bottom: 20px;">
                    <div class="plot-generation-section" style="margin-bottom: 15px;">
                        <button class="btn btn-generate-all" id="generateAllPlotPointsBtn" onclick="generateAllPlotPoints()" title="Generate connected plot points for all scenes">
                            üìã Generate All Plot Points
                        </button>
                        <button class="btn btn-outline" onclick="previewAllPlotPointsPrompt()" title="Preview the prompt used to generate all plot points">
                            üîç Preview Plot Points Prompt
                        </button>
                        <button class="btn btn-sm" onclick="showGlobalPlotPointsCreativeDirectionModal()" title="Add creative direction for all acts" style="background: linear-gradient(135deg, #ffd700, #ffed4e); color: #333; border: none; font-weight: 600; margin-left: 10px;">
                            üé® Add creative direction for all acts
                        </button>
                        <span class="plot-info" style="margin-left: 10px; font-size: 0.9em; color: #666;">
                            Creates causal connections between scenes using "but" / "therefore" logic
                        </span>
                    </div>

                    <p class="generation-info">
                        <strong>Tip:</strong> Generate plot points to create a strong narrative thread connecting your scenes with clear causal relationships.
                    </p>
                </div>
                
                <div id="plotPointsContent">
                    <!-- Plot points will be generated here -->
                </div>
                
                <div class="step-actions">
                    <!-- Universal navigation buttons will be added here dynamically -->
                </div>
            </div>
        </section>

        <!-- Step 5: Scenes Review -->
        <section class="workflow-step" id="step5">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">Story Input</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(2)">Template</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(3)">Acts</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(4)">Plot Points</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <span class="breadcrumb-current">Scenes</span>
                </div>
                <h2>Step 5: Generate Scenes
                    <div class="progress-meter" data-step="5">
                        <svg viewBox="0 0 40 40">
                            <circle class="progress-bg" cx="20" cy="20" r="16"></circle>
                            <circle class="progress-fill" cx="20" cy="20" r="16" 
                                    stroke-dasharray="0 100.48" stroke-dashoffset="0"></circle>
                        </svg>
                        <div class="progress-text">0%</div>
                    </div>
                </h2>
                <p class="step-description">Generate scenes for each story act using the plot points as guidance.</p>
                
                <!-- Scene Configuration -->
                <div class="scene-count-container">
                    <label for="totalScenes" style="margin-right: 8px; flex-shrink: 0;">Number of Scenes:</label>
                    <input type="number" id="totalScenes" name="totalScenes" value="70" min="20" max="150" required style="margin-right: 12px; flex-shrink: 0;">
                    <span id="screenplayEstimates" class="screenplay-estimates-inline" style="display: none; flex-shrink: 0;">
                        <span id="runtimeEst">~70 min</span> ‚Ä¢ <span id="scenesPerPlotEst">4.4 scenes/plot</span> ‚Ä¢ <span id="costEst">~$15</span>
                    </span>
                </div>
                
                <!-- Scenes Generation Options -->
                <div class="scenes-generation-options" id="scenesGenerationOptions" style="margin-bottom: 20px;">
                    <div class="scenes-generation-section" style="margin-bottom: 15px;">
                        <button class="btn btn-generate-all" id="generateAllScenesBtn" onclick="generateAllScenes()" title="Generate scenes for all acts that have plot points">
                            üé¨ Generate All Scenes
                        </button>
                        <button class="btn btn-outline" onclick="previewAllScenesPrompt()" title="Preview the prompts used to generate all scenes">
                            üîç Preview All Scenes Prompts
                        </button>
                        <button class="btn btn-sm" onclick="showGlobalScenesCreativeDirectionModal()" title="Add creative direction for all plot points" style="background: linear-gradient(135deg, #ffd700, #ffed4e); color: #333; border: none; font-weight: 600; margin-left: 10px;">
                            üé® Add creative direction for all plot points
                        </button>
                        <span class="scenes-info" style="margin-left: 10px; font-size: 0.9em; color: #666;">
                            Creates scenes based on the plot points from each story act
                        </span>
                    </div>

                    <p class="generation-info">
                        <strong>Tip:</strong> Scenes will only be generated for acts that have plot points. Complete Step 4 first to ensure all acts have plot points.
                    </p>
                </div>
                
                <div id="scenesContent">
                    <!-- Generated scenes will appear here -->
                </div>
                <div class="step-actions">
                    <!-- Universal navigation buttons will be added here dynamically -->
                </div>
            </div>
        </section>

        <!-- Step 6: Dialogue Generation -->
        <section class="workflow-step" id="step6">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">Story Input</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(2)">Template</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(3)">Acts</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(4)">Plot Points</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(5)">Scenes</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <span class="breadcrumb-current">Dialogue</span>
                </div>
                <h2>Step 6: Generate Dialogue
                    <div class="progress-meter" data-step="6">
                        <svg viewBox="0 0 40 40">
                            <circle class="progress-bg" cx="20" cy="20" r="16"></circle>
                            <circle class="progress-fill" cx="20" cy="20" r="16" 
                                    stroke-dasharray="0 100.48" stroke-dashoffset="0"></circle>
                        </svg>
                        <div class="progress-text">0%</div>
                    </div>
                </h2>
                <p class="step-description">Generate and review dialogue for each scene:</p>
                
                <!-- Dialogue Script Overview -->
                <div class="dialogue-script-overview">
                    <span class="script-info-label">Completion Estimate:</span>
                    <span id="dialogueScriptEstimates" class="screenplay-estimates-inline">
                        <span id="dialogueRuntimeEst">~70 min</span> ‚Ä¢ <span id="dialogueScenesPerPlotEst">4.4 scenes/plot</span> ‚Ä¢ <span id="dialogueCostEst">~$0.41 with Claude 4</span>
                    </span>
                </div>
                
                <!-- Dialogue Generation Options -->
                <div class="dialogue-generation-options" id="dialogueGenerationOptions" style="margin-bottom: 20px;">
                    <div class="dialogue-generation-section" style="margin-bottom: 15px;">
                        <button class="btn btn-generate-all" id="generateAllDialogueBtn" onclick="generateAllDialogue()" title="Generate dialogue for all scenes that exist">
                            üí¨ Generate All Dialogue
                        </button>
                        <button class="btn btn-outline" onclick="previewAllDialoguePrompts()" title="Preview the prompts used to generate all dialogue">
                            üîç Preview All Dialogue Prompts
                        </button>
                        <button class="btn btn-sm" onclick="showGlobalDialogueCreativeDirectionModal()" title="Add creative direction for all scenes" style="background: linear-gradient(135deg, #ffd700, #ffed4e); color: #333; border: none; font-weight: 600; margin-left: 10px;">
                            üé® Add creative direction for all scenes
                        </button>
                        <span class="dialogue-info" style="margin-left: 10px; font-size: 0.9em; color: #666;">
                            Creates professional dialogue for all generated scenes
                        </span>
                    </div>

                    <p class="generation-info">
                        <strong>Tip:</strong> Dialogue will only be generated for scenes that exist. Complete Step 5 first to ensure all acts have scenes.
                    </p>
                </div>
                
                <div id="dialogueContent">
                    <!-- Scene dialogue options will appear here -->
                </div>
                <div class="step-actions">
                    <!-- Universal navigation buttons will be added here dynamically -->
                </div>
            </div>
        </section>

        <!-- Step 7: Final Script & Export -->
        <section class="workflow-step" id="step7">
            <div class="card">
                <div class="step-breadcrumb">
                    <button class="breadcrumb-btn" onclick="goToStep(1)">Story Input</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(2)">Template</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(3)">Acts</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(4)">Plot Points</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(5)">Scenes</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <button class="breadcrumb-btn" onclick="goToStep(6)">Dialogue</button>
                    <span class="breadcrumb-separator">‚Üí</span>
                    <span class="breadcrumb-current">Final Script</span>
                </div>
                <h2>Step 7: Final Script
                    <div class="progress-meter" data-step="7">
                        <svg viewBox="0 0 40 40">
                            <circle class="progress-bg" cx="20" cy="20" r="16"></circle>
                            <circle class="progress-fill" cx="20" cy="20" r="16" 
                                    stroke-dasharray="0 100.48" stroke-dashoffset="0"></circle>
                        </svg>
                        <div class="progress-text">0%</div>
                    </div>
                </h2>
                <p class="step-description">Your completed script is ready for export:</p>
                
                <div class="script-stats">
                    <div class="stat">
                        <span class="stat-label">Scenes with Dialogue:</span>
                        <span class="stat-value" id="totalScenesDisplay">0/0 scenes</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Estimated Pages:</span>
                        <span class="stat-value" id="estimatedPagesDisplay">0</span>
                    </div>
                </div>

                <div class="script-preview" id="scriptPreview">
                    <!-- Final script preview -->
                </div>

                <div class="export-options">
                    <h3>üé¨ Professional Export Options</h3>
                    <div class="export-formats">
                        <div class="export-category">
                            <h4>üìÑ Industry Standard Formats</h4>
                            <button class="btn btn-primary" onclick="exportScript('screenplay')">
                                üìù Professional Screenplay (.txt)
                            </button>
                            <button class="btn btn-outline" onclick="exportScript('fountain')">
                                ‚õ≤ Fountain Format (.fountain)
                            </button>
                            <button class="btn btn-outline" onclick="exportScript('fdx')">
                                üé≠ Final Draft (.fdx)
                            </button>
                        </div>
                        
                        <div class="export-category">
                            <h4>üì¶ Production Ready</h4>
                            <button class="btn btn-success" onclick="exportScript('production')">
                                üé¨ Production Package
                            </button>
                            <button class="btn btn-outline" onclick="exportScript('pdf-ready')">
                                üìÑ PDF-Ready Format
                            </button>
                        </div>
                        
                        <div class="export-category">
                            <h4>üíæ Project Files</h4>
                            <button class="btn btn-outline" onclick="exportScript('json')">
                                üìÅ Export Project (.json)
                            </button>
                            <button class="btn btn-outline" onclick="saveProject()">
                                üíæ Save Project
                            </button>
                        </div>
                    </div>
                    
                    <div class="export-info">
                        <p><strong>üìã Format Guide:</strong></p>
                        <ul>
                            <li><strong>Professional Screenplay:</strong> Industry-standard formatting with proper margins and spacing</li>
                            <li><strong>Fountain:</strong> Plain-text markup language readable by most screenwriting software</li>
                            <li><strong>Final Draft:</strong> XML format compatible with Final Draft software</li>
                            <li><strong>Production Package:</strong> Complete package with script, character breakdown, and production notes</li>
                            <li><strong>PDF-Ready:</strong> Formatted for easy conversion to PDF with proper page breaks</li>
                        </ul>
                    </div>
                </div>

                <div class="step-actions">
                    <!-- Universal navigation buttons will be added here dynamically -->
                </div>
            </div>
        </section>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
            <p class="loading-text" id="loadingText">Generating content...</p>
        </div>

        <!-- Load Project Modal -->
        <div class="modal" id="loadProjectModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Load Previous Project</h3>
                    <button class="modal-close" onclick="hideLoadProjectModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="projectsList">
                        <p>Loading projects...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Prompt Preview Modal -->
        <div class="modal" id="promptPreviewModal">
            <div class="modal-content prompt-modal">
                <div class="modal-header">
                    <h3>Prompt Preview & Editor</h3>
                    <div class="prompt-controls">
                        <button class="btn btn-outline btn-sm" onclick="toggleEditMode()">‚úèÔ∏è Edit</button>
                        <button class="btn btn-outline btn-sm" onclick="resetPrompt()">üîÑ Reset</button>
                        <button class="btn btn-success btn-sm" id="savePromptBtn" onclick="saveCustomPrompt()" style="display: none;">üíæ Save</button>
                    </div>
                    <button class="modal-close" onclick="hidePromptPreviewModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="customPromptNotice" class="custom-prompt-notice" style="display: none;">
                        <p>üé® <strong>Custom Prompt Active:</strong> You're using a modified version of the original prompt.</p>
                    </div>
                    
                    <div class="prompt-section">
                        <h4>System Message:</h4>
                        <div class="prompt-content" id="systemMessageContent"></div>
                        <textarea class="prompt-editor" id="systemMessageEditor" style="display: none;"></textarea>
                    </div>
                    <div class="prompt-section">
                        <h4>User Prompt:</h4>
                        <div class="prompt-content" id="userPromptContent"></div>
                        <textarea class="prompt-editor" id="userPromptEditor" style="display: none;"></textarea>
                    </div>
                    <div class="prompt-section">
                        <h4>Template Structure:</h4>
                        <div class="prompt-content" id="templateStructureContent"></div>
                        <textarea class="prompt-editor" id="templateStructureEditor" style="display: none;"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hidePromptPreviewModal()">Close</button>
                    <button class="btn btn-primary" onclick="generateWithCurrentPrompt()">Generate with this Prompt</button>
                </div>
            </div>
        </div>

        <!-- Scene Prompt Modal -->
        <div class="modal" id="scenePromptModal">
            <div class="modal-content prompt-modal">
                <div class="modal-header">
                    <h3>Scene Generation Prompt</h3>
                    <button class="modal-close" onclick="hideScenePromptModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="prompt-section">
                        <h4>System Message:</h4>
                        <div class="prompt-content" id="scenePromptSystemMessage"></div>
                    </div>
                    <div class="prompt-section">
                        <h4>User Prompt:</h4>
                        <div class="prompt-content" id="scenePromptUserPrompt"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideScenePromptModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Plot Point Prompt Modal -->
        <div class="modal" id="plotPointPromptModal">
            <div class="modal-content prompt-modal">
                <div class="modal-header">
                    <h3>Plot Point Generation Prompt</h3>
                    <button class="modal-close" onclick="hidePlotPointPromptModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="prompt-section">
                        <h4>System Message:</h4>
                        <div class="prompt-content" id="plotPointPromptSystemMessage"></div>
                    </div>
                    <div class="prompt-section">
                        <h4>User Prompt:</h4>
                        <div class="prompt-content" id="plotPointPromptUserPrompt"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hidePlotPointPromptModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Individual Plot Point Prompt Modal -->
        <div class="modal" id="individualPlotPointPromptModal">
            <div class="modal-content prompt-modal">
                <div class="modal-header">
                    <h3>Individual Plot Point Regeneration Prompt</h3>
                    <button class="modal-close" onclick="hideIndividualPlotPointPromptModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="prompt-section">
                        <h4>System Message:</h4>
                        <div class="prompt-content" id="individualPlotPointPromptSystemMessage"></div>
                    </div>
                    <div class="prompt-section">
                        <h4>User Prompt:</h4>
                        <div class="prompt-content" id="individualPlotPointPromptUserPrompt"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideIndividualPlotPointPromptModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Dialogue Prompt Modal -->
        <div class="modal" id="dialoguePromptModal">
            <div class="modal-content prompt-modal">
                <div class="modal-header">
                    <h3>Dialogue Generation Prompt</h3>
                    <button class="modal-close" onclick="hideDialoguePromptModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="prompt-section">
                        <h4>System Message:</h4>
                        <div class="prompt-content" id="dialoguePromptSystemMessage"></div>
                    </div>
                    <div class="prompt-section">
                        <h4>User Prompt:</h4>
                        <div class="prompt-content" id="dialoguePromptUserPrompt"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideDialoguePromptModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Add Character Modal -->
        <div class="modal" id="addCharacterModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="characterModalTitle">Add Character</h3>
                    <button class="modal-close" onclick="hideCharacterModal()">&times;</button>
                </div>
                <form id="characterForm">
                    <div class="form-group">
                        <label for="characterName">Character Name</label>
                        <input type="text" id="characterName" name="characterName" required 
                               placeholder="e.g., Sarah Connor">
                    </div>
                    
                    <div class="form-group">
                        <label for="characterDescription">Character Description</label>
                        <textarea id="characterDescription" name="characterDescription" required rows="4"
                                  placeholder="Describe the character's role, personality, background, and psychological/social context..."></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="hideCharacterModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Character</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Select Character from Library Modal -->
        <div class="modal" id="characterLibraryModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add Character from Library</h3>
                    <button class="modal-close" onclick="hideCharacterLibraryModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="characterLibraryList">
                        <p>Loading character library...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideCharacterLibraryModal()">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Analyzed Prompt Modal -->
        <div id="analyzedPromptModal" class="modal" style="display: none;">
            <div class="modal-content large-modal">
                <div class="modal-header">
                    <h3>üìã Analyzed Prompt</h3>
                    <span class="close" onclick="hideAnalyzedPromptModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="prompt-info">
                        <p><strong>This is the exact prompt that was analyzed by The Genie for your story critique.</strong></p>
                        <p>It's identical to what would be sent for structure generation, ensuring perfect alignment between analysis and generation.</p>
                    </div>
                    <div class="prompt-content">
                        <pre id="analyzedPromptText"></pre>
                    </div>
                    <div class="template-info" id="templateInfo" style="display: none;">
                        <h4>Template Information</h4>
                        <div id="templateDetails"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" onclick="copyAnalyzedPrompt()">üìã Copy Prompt</button>
                    <button class="btn btn-primary" onclick="hideAnalyzedPromptModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Improvement Preview Modal -->
        <div id="improvementPreviewModal" class="modal" style="display: none;">
            <div class="modal-content large-modal">
                <div class="modal-header">
                    <div class="genie-improvements-header">
                    <img src="/askthegenie_black.png" alt="The Genie" class="genie-icon-header">
                    <h3>The Genie's Improvements</h3>
                </div>
                    <span class="close" onclick="hideImprovementPreviewModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="improvementPreviewContent">
                        <!-- Content will be dynamically populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Act Details Modal -->
        <div class="modal" id="actDetailsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="actDetailsModalTitle">Edit Act Details</h3>
                    <button class="modal-close" onclick="hideActDetailsModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="actDetailsName">Act Name</label>
                        <input type="text" id="actDetailsName" class="form-control" 
                               placeholder="e.g., Call to Adventure">
                    </div>
                    
                    <div class="form-group">
                        <label for="actDetailsDescription">Template Description</label>
                        <textarea id="actDetailsDescription" class="form-control" rows="3" 
                                  placeholder="Template description from the story structure..."></textarea>
                        <div class="form-help">
                            This is the original template description. Changes here modify the template structure.
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="actDetailsDirections">‚ú® Your Creative Directions</label>
                        <textarea id="actDetailsDirections" class="form-control" rows="4" 
                                  placeholder="Add your creative directions for this act...&#10;&#10;Examples:&#10;‚Ä¢ Show the character making a specific choice or taking a particular action&#10;‚Ä¢ Focus on the emotional impact this moment has on the protagonist&#10;‚Ä¢ Include a particular event or revelation you want to happen&#10;‚Ä¢ Emphasize specific visual elements or atmosphere"></textarea>
                        <div class="form-help">
                            <strong>‚ú® This is where you add your creative input!</strong> These directions will guide the AI to incorporate your specific vision while following the template structure.
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="actDetailsPlotPoints">Plot Points</label>
                        <input type="number" id="actDetailsPlotPoints" class="form-control" 
                               min="1" max="20" value="4">
                        <div class="form-help">
                            Number of plot points to generate for this act.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideActDetailsModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveActDetails()">Save Changes</button>
                </div>
            </div>
        </div>

        <!-- Acts Creative Direction Modal -->
        <div class="modal" id="actsCreativeDirectionModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="actsCreativeDirectionModalTitle">Creative Direction for Acts</h3>
                    <button class="modal-close" onclick="hideActsCreativeDirectionModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="actsActName">Act</label>
                        <input type="text" id="actsActName" class="form-control" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="actsCreativeDirections">‚ú® Your Creative Directions for This Act</label>
                        <textarea id="actsCreativeDirections" class="form-control" rows="5" 
                                  placeholder="Add your creative directions for this act...&#10;&#10;Examples:&#10;‚Ä¢ Show the character making a specific choice or taking a particular action&#10;‚Ä¢ Focus on the emotional impact this moment has on the protagonist&#10;‚Ä¢ Include a particular event or revelation you want to happen&#10;‚Ä¢ Emphasize specific visual elements or atmosphere"></textarea>
                        <div class="form-help">
                            <strong>‚ú® Refine your creative vision!</strong> These directions will influence how the AI regenerates this act's content.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideActsCreativeDirectionModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveActsCreativeDirection()">Save Creative Direction</button>
                </div>
            </div>
        </div>

        <!-- Plot Points Creative Direction Modal -->
        <div class="modal" id="plotPointsCreativeDirectionModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="plotPointsCreativeDirectionModalTitle">Creative Direction for Plot Points</h3>
                    <button class="modal-close" onclick="hidePlotPointsCreativeDirectionModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="plotPointsActName">Act</label>
                        <input type="text" id="plotPointsActName" class="form-control" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="plotPointsCreativeDirections">‚ú® Your Creative Directions for Plot Points</label>
                        <textarea id="plotPointsCreativeDirections" class="form-control" rows="5" 
                                  placeholder="Add your creative directions for plot points in this act...&#10;&#10;Examples:&#10;‚Ä¢ Focus on building tension between specific characters&#10;‚Ä¢ Establish a particular subplot or theme&#10;‚Ä¢ Include specific events or revelations&#10;‚Ä¢ Emphasize certain emotional beats or character development&#10;‚Ä¢ Show consequences of previous actions"></textarea>
                        <div class="form-help">
                            <strong>‚ú® Guide the plot points generation!</strong> These directions will influence how the AI creates the causal chain of plot points for this act.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hidePlotPointsCreativeDirectionModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="savePlotPointsCreativeDirection()">Save Creative Direction</button>
                </div>
            </div>
        </div>

        <!-- Scenes Creative Direction Modal -->
        <div class="modal" id="scenesCreativeDirectionModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="scenesCreativeDirectionModalTitle">Creative Direction for Scenes</h3>
                    <button class="modal-close" onclick="hideScenesCreativeDirectionModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="scenesActName">Act</label>
                        <input type="text" id="scenesActName" class="form-control" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="scenesPlotPointText">Plot Point</label>
                        <input type="text" id="scenesPlotPointText" class="form-control" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="scenesCreativeDirections">‚ú® Your Creative Directions for Scenes</label>
                        <textarea id="scenesCreativeDirections" class="form-control" rows="5" 
                                  placeholder="Add your creative directions for scenes in this plot point...&#10;&#10;Examples:&#10;‚Ä¢ Set the scene in a specific location or time of day&#10;‚Ä¢ Focus on particular character interactions or dialogue&#10;‚Ä¢ Include specific visual elements or atmosphere&#10;‚Ä¢ Show emotional beats or character reactions&#10;‚Ä¢ Establish pacing - fast action vs. slow contemplation&#10;‚Ä¢ Add sensory details (lighting, sounds, textures)"></textarea>
                        <div class="form-help">
                            <strong>‚ú® Direct the scene creation!</strong> These directions will influence how the AI crafts the individual scenes for this plot point.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideScenesCreativeDirectionModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveScenesCreativeDirection()">Save Creative Direction</button>
                </div>
            </div>
        </div>

        <!-- Dialogue Creative Direction Modal -->
        <div class="modal" id="dialogueCreativeDirectionModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="dialogueCreativeDirectionModalTitle">Creative Direction for Dialogue</h3>
                    <button class="modal-close" onclick="hideDialogueCreativeDirectionModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="dialogueActName">Act</label>
                        <input type="text" id="dialogueActName" class="form-control" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="dialogueSceneTitle">Scene</label>
                        <input type="text" id="dialogueSceneTitle" class="form-control" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="dialogueCreativeDirections">‚ú® Your Creative Directions for Dialogue</label>
                        <textarea id="dialogueCreativeDirections" class="form-control" rows="5" 
                                  placeholder="Add your creative directions for dialogue in this scene...&#10;&#10;Examples:&#10;‚Ä¢ Focus on specific character voices or speech patterns&#10;‚Ä¢ Include particular emotional tones (tension, humor, sadness)&#10;‚Ä¢ Add subtext - what characters really mean vs. what they say&#10;‚Ä¢ Emphasize conflict or resolution between characters&#10;‚Ä¢ Include specific information that needs to be revealed&#10;‚Ä¢ Set the dialogue pace (rapid-fire vs. contemplative)&#10;‚Ä¢ Add action lines between dialogue for visual storytelling"></textarea>
                        <div class="form-help">
                            <strong>‚ú® Guide the dialogue generation!</strong> These directions will influence how the AI writes the screenplay dialogue for this specific scene.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideDialogueCreativeDirectionModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveDialogueCreativeDirection()">Save Creative Direction</button>
                </div>
            </div>
        </div>

        <!-- Global Creative Direction Modals -->
        
        <!-- Global Plot Points Creative Direction Modal -->
        <div class="modal" id="globalPlotPointsCreativeDirectionModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Global Creative Direction - Plot Points Generation</h3>
                    <button class="modal-close" onclick="hideGlobalPlotPointsCreativeDirectionModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="modal-description">
                        <p><strong>This direction will apply to plot point generation for ALL acts in this story.</strong> You can still add specific directions for individual acts.</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="globalPlotPointsCreativeDirections">‚ú® Global Creative Direction for Plot Points</label>
                        <textarea id="globalPlotPointsCreativeDirections" class="form-control" rows="5" 
                                  placeholder="Add global creative direction for all plot points...&#10;&#10;Examples:&#10;‚Ä¢ Maintain a slow-burn thriller pace with gradual revelation of mysteries&#10;‚Ä¢ Focus on building tension and suspense throughout&#10;‚Ä¢ Emphasize character development over action sequences&#10;‚Ä¢ Include themes of redemption and second chances&#10;‚Ä¢ Show the psychological impact of decisions on characters"></textarea>
                        <div class="form-help">
                            <strong>‚ú® Set the overall tone!</strong> This direction will be applied to all plot point generation, combined with any specific act directions.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideGlobalPlotPointsCreativeDirectionModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveGlobalPlotPointsCreativeDirection()">Save Global Direction</button>
                </div>
            </div>
        </div>

        <!-- Global Scenes Creative Direction Modal -->
        <div class="modal" id="globalScenesCreativeDirectionModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Global Creative Direction - Scene Generation</h3>
                    <button class="modal-close" onclick="hideGlobalScenesCreativeDirectionModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="modal-description">
                        <p><strong>This direction will apply to scene generation for ALL plot points.</strong> You can still add specific directions for individual plot points.</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="globalScenesCreativeDirections">‚ú® Global Creative Direction for Scenes</label>
                        <textarea id="globalScenesCreativeDirections" class="form-control" rows="5" 
                                  placeholder="Add global creative direction for all scenes...&#10;&#10;Examples:&#10;‚Ä¢ Focus on showing character emotions through actions rather than exposition&#10;‚Ä¢ Emphasize visual storytelling with detailed location descriptions&#10;‚Ä¢ Include sensory details in every scene (sounds, lighting, atmosphere)&#10;‚Ä¢ Show character relationships through subtle interactions&#10;‚Ä¢ Maintain consistent pacing and rhythm across scenes"></textarea>
                        <div class="form-help">
                            <strong>‚ú® Set the scene style!</strong> This direction will be applied to all scene generation, combined with any specific plot point directions.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideGlobalScenesCreativeDirectionModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveGlobalScenesCreativeDirection()">Save Global Direction</button>
                </div>
            </div>
        </div>

        <!-- Global Dialogue Creative Direction Modal -->
        <div class="modal" id="globalDialogueCreativeDirectionModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Global Creative Direction - Dialogue Generation</h3>
                    <button class="modal-close" onclick="hideGlobalDialogueCreativeDirectionModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="modal-description">
                        <p><strong>This direction will apply to dialogue generation for ALL scenes.</strong> You can still add specific directions for individual scenes.</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="globalDialogueCreativeDirections">‚ú® Global Creative Direction for Dialogue</label>
                        <textarea id="globalDialogueCreativeDirections" class="form-control" rows="5" 
                                  placeholder="Add global creative direction for all dialogue...&#10;&#10;Examples:&#10;‚Ä¢ Write dialogue in a film noir style with sharp, witty exchanges&#10;‚Ä¢ Use subtext - characters rarely say what they really mean&#10;‚Ä¢ Include period-appropriate language and speech patterns&#10;‚Ä¢ Focus on conflict and tension in every conversation&#10;‚Ä¢ Show character personality through unique speech patterns"></textarea>
                        <div class="form-help">
                            <strong>‚ú® Set the dialogue voice!</strong> This direction will be applied to all dialogue generation, combined with any specific scene directions.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideGlobalDialogueCreativeDirectionModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveGlobalDialogueCreativeDirection()">Save Global Direction</button>
                </div>
            </div>
        </div>

        <!-- Notification Toast -->
        <div class="toast" id="toast">
            <div class="toast-content">
                <span class="toast-message" id="toastMessage"></span>
                <button class="toast-close" onclick="hideToast()">&times;</button>
            </div>
        </div>
    </div>

    <script src="data-loader.js"></script>
    <script src="api-client.js?v=1.0"></script>
    <script src="unified-credits.js?v=1.0"></script>
    <script src="progress-tracker.js?v=1.0"></script>
    
    <!-- üîß Phase 4B: Modular Components (load before genie-suggestions) -->
    <script src="components/modal-system.js?v=1.0"></script>
    <script src="components/form-components.js?v=1.0"></script>
    <script src="components/tag-manager.js?v=1.0"></script>
    <script src="components/editable-content-system.js?v=1.0"></script>
    <script src="components/progress-tracker.js?v=1.0"></script>
    <script src="components/story-analysis-system.js?v=1.0"></script>
    
    <!-- üîß NEW: Auth Manager Component (Phase 1A: Core System Extraction) -->
    <script src="components/auth-manager.js?v=1.0"></script>
    
    <!-- üîß NEW: App State Manager Component (Phase 1A: Core System Extraction) -->
    <script src="components/app-state-manager.js?v=1.0"></script>
    
    <!-- üîß NEW: Template Manager Component (Phase 1A: Core System Extraction) -->
    <script src="components/template-manager.js?v=1.0"></script>
    <!-- Character Manager Component -->
    <script src="components/character-manager.js?v=1.0"></script>
    
    <!-- Creative Direction Manager Component -->
    <script src="components/creative-direction-manager.js?v=1.0"></script>
    
    <!-- Generation Helper Manager Component -->
    <script src="components/generation-helper-manager.js?v=1.0"></script>
    
    <!-- Generation Button Manager Component -->
    <script src="components/generation-button-manager.js?v=1.0"></script>
    
    <!-- Structure Generation Manager Component -->
    <script src="components/structure-generation-manager.js?v=1.0"></script>
    
    <!-- Plot Points Generation Manager Component -->
    <script src="components/plot-points-generation-manager.js?v=1.0"></script>
    
    <!-- Scene Generation Manager Component -->
    <script src="components/scene-generation-manager.js?v=1.0"></script>
    
    <!-- Dialogue Generation Manager Component -->
    <script src="components/dialogue-generation-manager.js?v=1.0"></script>
    
    <!-- Project Manager Component -->
    <script src="components/project-manager.js?v=1.0"></script>
    
    <!-- Library Manager Component -->
    <script src="components/library-manager.js?v=1.0"></script>
    
    <!-- UI Manager Component -->
    <script src="components/ui-manager.js?v=1.0"></script>
    
    <!-- Script Assembly Manager Component -->
    <script src="components/script-assembly-manager.js?v=1.0"></script>
    
    <!-- App Initialization Manager Component -->
    <script src="components/app-initialization-manager.js?v=1.0"></script>
    
    <!-- Navigation & Workflow Manager Component -->
    <script src="components/navigation-workflow-manager.js?v=1.0"></script>
    
    <!-- Feedback Manager Component -->
    <script src="components/feedback-manager.js?v=1.0"></script>
    
    <script src="genie-suggestions.js?v=1.0"></script>
    <script src="script.js?v=20250627222030"></script>

    <!-- üîß ROBUST INITIALIZATION - Prevent SceneGenerationManager failures -->
    <script>
    // Bulletproof scene generation system
    document.addEventListener('DOMContentLoaded', function() {
        // Multiple initialization attempts to prevent flimsy failures
        let initAttempts = 0;
        const maxAttempts = 5;
        
        function initializeSceneGeneration() {
            initAttempts++;
            console.log(`üîß Scene generation init attempt ${initAttempts}/${maxAttempts}`);
            
            if (typeof SceneGenerationManager !== 'undefined') {
                window.sceneGenerationManager = new SceneGenerationManager();
                console.log('‚úÖ SceneGenerationManager initialized successfully');
                return true;
            }
            
            // If class not found, ensure legacy functions work
            if (typeof generateAllScenes !== 'undefined') {
                console.log('‚úÖ Using legacy scene generation functions');
                // Create a mock sceneGenerationManager that uses legacy functions
                window.sceneGenerationManager = {
                    generateAllScenes: window.generateAllScenes,
                    displayScenes: window.displayScenes || function(scenes) {
                        console.log('Displaying scenes:', scenes);
                    }
                };
                return true;
            }
            
            if (initAttempts < maxAttempts) {
                console.log(`‚è≥ Retrying scene generation init in 200ms...`);
                setTimeout(initializeSceneGeneration, 200);
                return false;
            }
            
            console.error('‚ùå FAILED to initialize scene generation after all attempts');
            return false;
        }
        
        // Start first attempt after a short delay
        setTimeout(initializeSceneGeneration, 100);
    });
    </script>
</body>
</html> 
